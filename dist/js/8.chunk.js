(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{362:function(e,r,t){},376:function(e,r,t){"use strict";var a=t(362);t.n(a).a},389:function(e,r,t){"use strict";t.r(r);var a=t(33),o=t.n(a),s=t(52),n=t.n(s),u=t(111),i=t(53),l=t(23),c=t.n(l),d={id:null,groupId:null,name:null,username:null,email:null,mobile:null,password:null},p={id:null,parentId:0,name:null},m={password:[{required:!0,message:"请输入密码",trigger:"change"},{min:8,max:20,message:"请输入8到20位密码",trigger:"blur"}],repeatPassword:[{required:!0,message:"请输入重复密码",trigger:"change"}]},f={groupId:[{required:!0,message:"请选择部门",trigger:"change"}],name:[{required:!0,message:"请输入姓名",trigger:"change"}],username:[{required:!0,message:"请输入成员名",trigger:"change"}],email:[{required:!0,message:"请输入邮箱",trigger:"change"},{type:"email",message:"请输入正确的邮箱",trigger:"change"}],mobile:[{required:!0,message:"请输入手机号",trigger:"change"}]},g={name:[{required:!0,message:"请输入部门名称",trigger:"change"}]},h={name:"Persmissionaccounts",data:function(){return{pageLoading:!1,showUserFormModal:!1,showGroupFormModal:!1,formLabelWidth:"80px",userForm:c()({},d),groupForm:c()({},p),userFormRules:{},groupFormRules:c.a.recursive(!0,{},g),selectGroup:{},accounts:[],showAccounts:[],accountsCount:0,groupTree:[],groupFormGroups:[{id:0,name:"无"}],userFormGroups:[]}},mounted:function(){var e=n()(o.a.mark(function e(){var r,t=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.pageLoading=!0,e.next=3,u.o();case 3:(r=e.sent).code===i.b&&(r.data.accounts&&(r.data.accounts.accounts.forEach(function(e){t.accounts.push(c()({},e)),t.showAccounts.push(c()({},e))}),this.accountsCount=r.data.accounts.count),r.data.groups.forEach(function(e){t.userFormGroups.push(c()({},e))}),this.appendGroupTreeNode({id:0,name:"所有部门",parentId:0}),this.$refs.groupTree.setCurrentKey({id:0}),r.data.groups.forEach(function(e){t.groupFormGroups.push(e),t.appendGroupTreeNode(e)}),this.pageLoading=!1);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{submitUserForm:function(){var e,r=this;this.$refs.userForm.validate((e=n()(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}if(r.userForm.groupId=parseInt(r.userForm.groupId),!r.userForm.id){e.next=6;break}return e.delegateYield(o.a.mark(function e(){var t,a,s,n,l,d;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.C(r.userForm);case 2:if((t=e.sent).code!==i.b){e.next=24;break}r.showUserFormModal=!1,a=0;case 6:if(!(a<r.accounts.length)){e.next=13;break}if(r.accounts[a].id!==t.data.id){e.next=10;break}return r.accounts[a]=c()(r.accounts[a],t.data),e.abrupt("break",13);case 10:a++,e.next=6;break;case 13:s=0;case 14:if(!(s<r.showAccounts.length)){e.next=21;break}if(r.showAccounts[s].id!==t.data.id){e.next=18;break}return r.showAccounts[s]=c()(r.showAccounts[s],t.data),e.abrupt("break",21);case 18:s++,e.next=14;break;case 21:r.$message({message:"成员更新成功",type:"success"}),e.next=25;break;case 24:if(t.code===i.c){for(d in n=c.a.recursive(!0,{},r.userFormRules),l=function(e){void 0===r.userFormRules[e]&&(r.userFormRules[e]=[]),r.userFormRules[e].push({validator:function(r,a,o){o(new Error(t.data[e][0]))},trigger:"blur"}),r.$refs.userForm.validateField(e)},t.data)l(d);r.userFormRules=c.a.recursive(!0,{},n)}else r.$message({message:t.message,type:"warning"});case 25:case"end":return e.stop()}},e,r)})(),"t0",4);case 4:e.next=7;break;case 6:return e.delegateYield(o.a.mark(function e(){var t,a,s,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.q(r.userForm);case 2:if((t=e.sent).code===i.b)r.showUserFormModal=!1,r.accounts.push(t.data),r.showAccounts.push(t.data),r.$message({message:"成员添加成功",type:"success"});else if(t.code===i.c){for(n in a=c.a.recursive(!0,{},r.userFormRules),s=function(e){void 0===r.userFormRules[e]&&(r.userFormRules[e]=[]),r.userFormRules[e].push({validator:function(r,a,o){o(new Error(t.data[e][0]))},trigger:"blur"}),r.$refs.userForm.validateField(e)},t.data)s(n);r.userFormRules=c.a.recursive(!0,{},a)}else r.$message({message:t.message,type:"warning"});case 4:case"end":return e.stop()}},e,r)})(),"t1",7);case 7:e.next=10;break;case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}},e,r)})),function(r){return e.apply(this,arguments)}))},submitGroupForm:function(){var e,r=this;this.$refs.groupForm.validate((e=n()(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}if(r.groupForm.parentId=parseInt(r.groupForm.parentId),!r.groupForm.id){e.next=6;break}return e.delegateYield(o.a.mark(function e(){var t,a,s,n,l,d,p;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.D(r.groupForm);case 2:if((t=e.sent).code!==i.b){e.next=28;break}r.showGroupFormModal=!1,a=0;case 6:if(!(a<r.userFormGroups.length)){e.next=13;break}if(r.userFormGroups[a].id!==t.data.id){e.next=10;break}return r.userFormGroups[a]=t.data,e.abrupt("break",13);case 10:a++,e.next=6;break;case 13:s=0;case 14:if(!(s<r.groupFormGroups.length)){e.next=21;break}if(r.groupFormGroups[s].id!==t.data.id){e.next=18;break}return r.groupFormGroups[s]=t.data,e.abrupt("break",21);case 18:s++,e.next=14;break;case 21:(n=r.$refs.groupTree.getNode({id:t.data.id})).data.name=t.data.name,n.data.label=t.data.name,t.data.parentId!==n.data.parentId&&(n.parentId=t.data.parentId,r.$refs.groupTree.remove(n),l=r.$refs.groupTree.getNode({id:t.data.parentId}),r.$refs.groupTree.append(n,l)),r.$message({message:"部门更新成功",type:"success"}),e.next=29;break;case 28:if(t.code===i.c){for(p in d=function(e){void 0===r.groupFormRules[e]&&(r.groupFormRules[e]=[]),r.groupFormRules[e].push({validator:function(r,a,o){o(new Error(t.data[e][0]))},trigger:"blur"}),r.$refs.groupForm.validateField(e)},t.data)d(p);r.groupFormRules=c.a.recursive(!0,{},g)}else r.$message({message:t.message,type:"warning"});case 29:case"end":return e.stop()}},e,r)})(),"t0",4);case 4:e.next=7;break;case 6:return e.delegateYield(o.a.mark(function e(){var t,a,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.r(r.groupForm);case 2:if((t=e.sent).code===i.b)r.showGroupFormModal=!1,r.userFormGroups.push(t.data),r.groupFormGroups.push(t.data),r.appendGroupTreeNode(t.data),r.$message({message:"部门添加成功",type:"success"});else if(t.code===i.c){for(s in a=function(e){void 0===r.groupFormRules[e]&&(r.groupFormRules[e]=[]),r.groupFormRules[e].push({validator:function(r,a,o){o(new Error(t.data[e][0]))},trigger:"blur"}),r.$refs.groupForm.validateField(e)},t.data)a(s);r.groupFormRules=c.a.recursive(!0,{},g)}else r.$message({message:t.message,type:"warning"});case 4:case"end":return e.stop()}},e,r)})(),"t1",7);case 7:e.next=10;break;case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}},e,r)})),function(r){return e.apply(this,arguments)}))},openEditAccount:function(e){this.showUserFormModal=!0,this.userFormRules=c.a.recursive(!0,{},f),this.userForm=c()({},e),void 0!==this.$refs.userForm&&this.$refs.userForm.resetFields()},openUserFormModal:function(){var e=this;this.showUserFormModal=!0,this.userFormRules=c.a.recursive(!0,{},f,m),this.userFormRules.repeatPassword.push({validator:function(r,t,a){""===t?a(new Error("请再次输入密码")):(t!==e.userForm.password&&a(new Error("两次密码不一致")),a())},trigger:"blur"}),this.userForm=c()({},d),void 0!==this.$refs.userForm&&this.$refs.userForm.resetFields()},openGroupFormModal:function(){this.showGroupFormModal=!0,this.groupForm=c()({},p),void 0!==this.$refs.groupForm&&this.$refs.groupForm.resetFields()},openEditGroup:function(e){this.showGroupFormModal=!0,this.groupForm=c()({},e),void 0!==this.$refs.groupForm&&this.$refs.groupForm.resetFields()},clickDimission:function(e){var r=this,t=this;this.$confirm("标注 "+e.name+" 为离职状态？","离职",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(n()(o.a.mark(function a(){var s,n,l;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,u.z({id:e.id});case 2:if((s=a.sent).code===i.b){for(n=0;n<t.showAccounts.length;n++)t.showAccounts[n].id===s.data.id&&(t.showAccounts[n].status=s.data.status,t.showAccounts[n].statusText=s.data.statusText);for(l=0;l<t.accounts.length;l++)t.accounts[l].id===s.data.id&&(t.accounts[l].status=s.data.status,t.accounts[l].statusText=s.data.statusText);r.$message({type:"success",message:"已标注 "+e.name+" 为离职状态"})}case 4:case"end":return a.stop()}},a,r)})))},clickResume:function(e){var r=this,t=this;this.$confirm("恢复 "+e.name+" 为在职状态？","复职",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(n()(o.a.mark(function a(){var s,n,l;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,u.B({id:e.id});case 2:if((s=a.sent).code===i.b){for(n=0;n<t.showAccounts.length;n++)t.showAccounts[n].id===s.data.id&&(t.showAccounts[n].status=s.data.status,t.showAccounts[n].statusText=s.data.statusText);for(l=0;l<t.accounts.length;l++)t.accounts[l].id===s.data.id&&(t.accounts[l].status=s.data.status,t.accounts[l].statusText=s.data.statusText);r.$message({type:"success",message:"已恢复 "+e.name+" 为在职状态"})}case 4:case"end":return a.stop()}},a,r)})))},clickResetPassword:function(e){var r=this;this.$confirm("重置 "+e.name+" 的账户密码？","重置密码",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(n()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.A(e.id);case 2:t.sent.code===i.b&&r.$message({type:"success",message:"已重置 "+e.name+" 的账户密码"});case 4:case"end":return t.stop()}},t,r)})))},deleteGroup:function(e){var r=this;this.$confirm("确定删除 "+e.name+" ？","删除部门",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(n()(o.a.mark(function t(){var a,s,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.c(e.id);case 2:if((a=t.sent).code!==i.b){t.next=27;break}r.showGroupFormModal=!1,s=0;case 6:if(!(s<r.groupFormGroups.length)){t.next=13;break}if(r.groupFormGroups[s].id!==e.id){t.next=10;break}return r.groupFormGroups.splice(s,1),t.abrupt("break",13);case 10:s++,t.next=6;break;case 13:n=0;case 14:if(!(n<r.userFormGroups.length)){t.next=21;break}if(r.userFormGroups[n].id!==e.id){t.next=18;break}return r.userFormGroups.splice(n,1),t.abrupt("break",21);case 18:n++,t.next=14;break;case 21:r.$refs.groupTree.remove({id:e.id}),r.$refs.groupTree.setCurrentKey({id:0}),r.clickGroup({id:0}),r.$message({type:"success",message:"已删除 "+e.name}),t.next=28;break;case 27:r.$message({type:"warning",message:a.message});case 28:case"end":return t.stop()}},t,r)})))},handleCommand:function(e){switch(e){case"group":this.openGroupFormModal();break;case"account":this.openUserFormModal()}},appendGroupTreeNode:function(e){0!==e.id?this.$refs.groupTree.append({id:e.id,label:e.name,name:e.name,parentId:e.parentId},{id:e.parentId}):this.$refs.groupTree.append({id:e.id,label:e.name})},clickGroup:function(e){var r=this;this.selectGroup=e,0===e.id?this.showAccounts=this.accounts:(this.showAccounts=[],this.accounts.forEach(function(t){var a=r.getGroupLevel(t.groupId);console.log(e.id),(t.groupId===e.id||a.indexOf(e.id+",")>-1)&&r.showAccounts.push(c()({},t))}))},getGroupLevel:function(e){for(var r=0;r<this.userFormGroups.length;r++)if(this.userFormGroups[r].id===e)return this.userFormGroups[r].level;return""},handleDragStart:function(e,r){console.log("drag start",e)},handleDragEnter:function(e,r,t){console.log("tree drag enter: ",r.label)},handleDragLeave:function(e,r,t){console.log("tree drag leave: ",r.label)},handleDragOver:function(e,r,t){console.log("tree drag over: ",r.label)},handleDragEnd:function(e,r,t,a){console.log("tree drag end: ",r&&r.label,t)},handleDrop:function(e,r,t,a){console.log("tree drop: ",r.label,t)},allowDrop:function(e,r,t){return"二级 3-1"!==r.data.label||"inner"!==t},allowDrag:function(e){return-1===e.data.label.indexOf("三级 3-2-2")}}},v=(t(376),t(0)),b=Object(v.a)(h,function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("c-main",{attrs:{id:"page-accounts"}},[t("header",{staticClass:"toolbar"},[t("c-level",[t("template",{slot:"left"},[t("div",{staticClass:"cell"},[t("div",{staticClass:"cell__content"},[t("h1",{staticClass:"toolbar__title"},[e._v("\n              成员管理\n              "),t("span",[e._v("管理平台的部门和成员")])])])])]),e._v(" "),t("template",{slot:"right"},[t("el-dropdown",{on:{command:e.handleCommand}},[t("el-button",{attrs:{type:"primary",size:"small"}},[e._v("添加")]),e._v(" "),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"account"}},[e._v("添加成员")]),e._v(" "),t("el-dropdown-item",{attrs:{command:"group"}},[e._v("添加部门")])],1)],1)],1)],2)],1),e._v(" "),t("el-container",[t("el-aside",[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("部门列表")])]),e._v(" "),t("el-tree",{ref:"groupTree",attrs:{data:e.groupTree,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,"highlight-current":!0,"allow-drop":e.allowDrop,"allow-drag":e.allowDrag},on:{"node-drag-start":e.handleDragStart,"node-drag-enter":e.handleDragEnter,"node-drag-leave":e.handleDragLeave,"node-drag-over":e.handleDragOver,"node-drag-end":e.handleDragEnd,"node-drop":e.handleDrop,"node-click":e.clickGroup},scopedSlots:e._u([{key:"default",fn:function(r){var a=r.node,o=r.data;return t("span",{staticClass:"custom-tree-node"},[t("span",[e._v(e._s(a.label))]),e._v(" "),t("span",[0!==o.id?t("el-button",{staticClass:"icon-pen5",attrs:{type:"text",size:"mini"},on:{click:function(r){e.openEditGroup(o)}}}):e._e()],1)])}}])})],1)],1),e._v(" "),t("el-main",[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("成员列表")])]),e._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticStyle:{width:"100%"},attrs:{data:e.showAccounts,border:""}},[t("el-table-column",{attrs:{prop:"name",label:"姓名",width:"180"}}),e._v(" "),t("el-table-column",{attrs:{label:"部门",width:"180"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{},[e._v(e._s(r.row.groupName||"-"))])}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e._v(" "),t("el-table-column",{attrs:{prop:"mobile",label:"电话"}}),e._v(" "),t("el-table-column",{attrs:{prop:"statusText",label:"状态"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{staticStyle:{"text-align":"center",display:"block",width:"100%"}},[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){e.openEditAccount(r.row)}}},[e._v("编辑")]),e._v(" "),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1===r.row.status,expression:"scope.row.status === 1"}],attrs:{type:"text",size:"mini"},on:{click:function(t){e.clickDimission(r.row)}}},[e._v("离职")]),e._v(" "),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2===r.row.status,expression:"scope.row.status === 2"}],attrs:{type:"text",size:"mini"},on:{click:function(t){e.clickResume(r.row)}}},[e._v("复职")]),e._v(" "),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){e.clickResetPassword(r.row)}}},[e._v("重置密码")])],1)}}])})],1)],1)],1)],1),e._v(" "),t("el-dialog",{attrs:{title:e.userForm.id?"编辑成员":"添加成员",visible:e.showUserFormModal},on:{"update:visible":function(r){e.showUserFormModal=r}}},[t("el-form",{ref:"userForm",attrs:{model:e.userForm,rules:e.userFormRules,"validate-on-rule-change":!1}},[t("el-form-item",{attrs:{label:"部门","label-width":e.formLabelWidth,prop:"groupId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择成员所属部门"},model:{value:e.userForm.groupId,callback:function(r){e.$set(e.userForm,"groupId",r)},expression:"userForm.groupId"}},e._l(e.userFormGroups,function(e){return t("el-option",{key:"userGroup"+e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"姓名","label-width":e.formLabelWidth,prop:"name"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.userForm.name,callback:function(r){e.$set(e.userForm,"name",r)},expression:"userForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"成员名","label-width":e.formLabelWidth,prop:"username"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.userForm.username,callback:function(r){e.$set(e.userForm,"username",r)},expression:"userForm.username"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"邮箱","label-width":e.formLabelWidth,prop:"email"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.userForm.email,callback:function(r){e.$set(e.userForm,"email",r)},expression:"userForm.email"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"手机","label-width":e.formLabelWidth,prop:"mobile"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.userForm.mobile,callback:function(r){e.$set(e.userForm,"mobile",r)},expression:"userForm.mobile"}})],1),e._v(" "),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.userForm.id,expression:"!userForm.id"}],attrs:{label:"密码","label-width":e.formLabelWidth,prop:"password"}},[t("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.userForm.password,callback:function(r){e.$set(e.userForm,"password",r)},expression:"userForm.password"}})],1),e._v(" "),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.userForm.id,expression:"!userForm.id"}],attrs:{label:"重复密码","label-width":e.formLabelWidth,prop:"repeatPassword"}},[t("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.userForm.repeatPassword,callback:function(r){e.$set(e.userForm,"repeatPassword",r)},expression:"userForm.repeatPassword"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(r){e.showUserFormModal=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(r){e.submitUserForm()}}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:e.groupForm.id?"编辑部门":"添加部门",visible:e.showGroupFormModal},on:{"update:visible":function(r){e.showGroupFormModal=r}}},[t("el-form",{ref:"groupForm",attrs:{model:e.groupForm,rules:e.groupFormRules,"validate-on-rule-change":!1}},[t("el-form-item",{attrs:{label:"父部门","label-width":e.formLabelWidth}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择父部门"},model:{value:e.groupForm.parentId,callback:function(r){e.$set(e.groupForm,"parentId",r)},expression:"groupForm.parentId"}},e._l(e.groupFormGroups,function(e){return t("el-option",{key:"groupFromGroups"+e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"部门名称","label-width":e.formLabelWidth,prop:"name"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.groupForm.name,callback:function(r){e.$set(e.groupForm,"name",r)},expression:"groupForm.name"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.groupForm.id,expression:"groupForm.id"}],staticStyle:{float:"left"},on:{click:function(r){e.deleteGroup(e.groupForm)}}},[e._v("删除部门")]),e._v(" "),t("el-button",{on:{click:function(r){e.showGroupFormModal=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(r){e.submitGroupForm()}}},[e._v("确 定")])],1)],1)],1)},[],!1,null,null,null);b.options.__file="accounts.vue";r.default=b.exports}}]);