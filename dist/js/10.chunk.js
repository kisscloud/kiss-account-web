(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{364:function(e,s,t){},380:function(e,s,t){"use strict";var i=t(364);t.n(i).a},387:function(e,s,t){"use strict";t.r(s);var i=t(33),o=t.n(i),r=t(52),l=t.n(r),n=t(111),a=t(53),m=t(23),c=t.n(m),d={name:null,status:"1"},u={},p={name:"PersmissionUsers",data:function(){return{pageLoading:!1,showRoleFormModal:!1,showRolePermissionModal:!1,couldShowRolePermissionModal:!1,tabActiveName:"first",selectRole:{},selectPermissions:[],editRolePermissions:[],permissions:[],accounts:[],selectAccounts:[],filterMethod:function(e,s){return s.label.indexOf(e)>-1},roleForm:c()({},d),rolePermissionForm:c()({},u),roleFormRules:{name:[{required:!0,message:"请输入角色名称",trigger:"change"}]},roles:[],permissionTree:[],defaultProps:{children:"children",label:"label"}}},mounted:function(){var e=l()(o.a.mark(function e(){var s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.pageLoading=!0,e.next=3,n.n();case 3:(s=e.sent).code===a.b&&(this.roles=s.data.roles||[],this.selectPermissions=s.data.firstRolePermissions||[],this.selectAccounts=s.data.firstRoleAccounts||[],this.couldShowRolePermissionModal=!0,this.modules=s.data.modules||[],this.allAccounts=s.data.accounts?s.data.accounts.accounts:[],this.permissions=s.data.permissions||[],this.generatePermissionTree()),this.pageLoading=!1;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{submitRoleForm:function(){var e,s=this;this.$refs.roleForm.validate((e=l()(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}if(!s.roleForm.id){e.next=5;break}return e.delegateYield(o.a.mark(function e(){var t,i,r,l,m;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s.roleForm.status=parseInt(s.roleForm.status),e.next=3,n.I(s.roleForm);case 3:if((t=e.sent).code!==a.b){e.next=18;break}s.showRoleFormModal=!1,i=0;case 7:if(!(i<s.roles.length)){e.next=15;break}if(s.roles[i].id!==t.data.id){e.next=12;break}return s.roles[i].name=t.data.name,s.roles[i].status=t.data.status,e.abrupt("break",15);case 12:i++,e.next=7;break;case 15:s.$message({message:"角色更新成功",type:"success"}),e.next=19;break;case 18:if(t.code===a.c){for(m in s.roleForm.status=""+s.roleForm.status,r=c.a.recursive(!0,{},s.roleFormRules),l=function(e){void 0===s.roleFormRules[e]&&(s.roleFormRules[e]=[]),s.roleFormRules[e].push({validator:function(s,i,o){o(new Error(t.data[e][0]))},trigger:"blur"}),s.$refs.roleForm.validateField(e)},t.data)l(m);s.roleFormRules=c.a.recursive(!0,{},r)}else s.$message({message:t.message,type:"warning"});case 19:case"end":return e.stop()}},e,s)})(),"t0",3);case 3:e.next=6;break;case 5:return e.delegateYield(o.a.mark(function e(){var t,i,r,l;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.w(s.roleForm);case 2:if((t=e.sent).code===a.b)s.showRoleFormModal=!1,s.roles.push(t.data),s.$message({message:"角色添加成功",type:"success"});else if(t.code===a.c){for(l in s.roleForm.status=""+s.roleForm.status,i=c.a.recursive(!0,{},s.roleFormRules),r=function(e){void 0===s.roleFormRules[e]&&(s.roleFormRules[e]=[]),s.roleFormRules[e].push({validator:function(s,i,o){o(new Error(t.data[e][0]))},trigger:"blur"}),s.$refs.roleForm.validateField(e)},t.data)r(l);s.roleFormRules=c.a.recursive(!0,{},i)}else s.$message({message:t.message,type:"warning"});case 4:case"end":return e.stop()}},e,s)})(),"t1",6);case 6:e.next=10;break;case 8:return console.log("error submit!!"),e.abrupt("return",!1);case 10:case"end":return e.stop()}},e,s)})),function(s){return e.apply(this,arguments)}))},generatePermissionTree:function(){var e=this;this.modules.length>0&&this.appendPermissionTreeNode({id:0,name:"全部权限",disabled:!0}),this.modules.forEach(function(s){e.appendPermissionTreeNode(s)}),this.roles.length>0&&(this.selectRole=this.roles[0],this.$refs.roleTable.setCurrentRow(this.roles[0])),this.allAccounts.forEach(function(s){e.accounts.push({label:s.name,key:s.id})}),this.permissions.forEach(function(s){e.$refs.permissionTree.append({id:s.id,type:s.type,label:s.name,code:s.code,limitFields:s.limitFields,limitString:"",limitDescription:""},{id:"module"+s.moduleId})})},openRoleFormModal:function(){this.showRoleFormModal=!0,this.roleForm=c()({},d),this.$refs.roleForm&&this.$refs.roleForm.resetFields()},openEditRoleModal:function(e){this.showRoleFormModal=!0,this.$refs.roleForm&&this.$refs.roleForm.resetFields(),this.roleForm=c()({},e),this.roleForm.status=""+e.status},openRolePermissionModal:function(e,s){if(s&&e.code&&this.couldShowRolePermissionModal)if(this.rolePermissionForm=c()({},u),this.showRolePermissionModal=!0,this.rolePermissionForm.id=e.id,this.rolePermissionForm.code=e.code,this.rolePermissionForm.name=e.label,this.rolePermissionForm.limitFields=e.limitFields,this.rolePermissionForm.type=""+e.type,1!=e.type)this.rolePermissionForm.limitString=e.code;else for(var t=0;t<this.editRolePermissions.length;t++)this.editRolePermissions[t].permissionId===e.id&&(this.rolePermissionForm.limitString=this.editRolePermissions[t].limitString,this.rolePermissionForm.limitDescription=this.editRolePermissions[t].limitDescription)},addRolePermission:function(){var e=this.$refs.permissionTree.getNode({id:this.rolePermissionForm.id});1===this.rolePermissionForm.type&&(this.rolePermissionForm.limitString?e.data.limitString=this.rolePermissionForm.code+"?"+this.rolePermissionForm.limitString:e.data.limitString=this.rolePermissionForm.code),e.data.limitDescription=this.rolePermissionForm.limitDescription,this.showRolePermissionModal=!1},cancelRolePermission:function(e){this.$refs.permissionTree.setChecked({id:e.id},!1),this.showRolePermissionModal=!1},appendPermissionTreeNode:function(e){0!==e.id?this.$refs.permissionTree.append({id:"module"+e.id,label:e.name,disabled:!0},{id:"module"+e.parentId}):this.$refs.permissionTree.append({id:"module"+e.id,label:e.name,code:e.code,description:e.description})},savePermissions:function(){var e=l()(o.a.mark(function e(){var s,t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],this.$refs.permissionTree.getCheckedNodes().forEach(function(e){void 0!==e.code&&e.code&&s.push({permissionId:e.id,limitString:e.limitString,limitDescription:e.limitDescription})}),0!==s.length){e.next=5;break}return this.$message({message:"请选择权限",type:"info"}),e.abrupt("return");case 5:return e.next=7,n.v({roleId:this.selectRole.id,permissions:s});case 7:(t=e.sent).code===a.b?this.$message({message:"权限绑定成功",type:"success"}):this.$message({message:t.message,type:"warning"});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),saveAccounts:function(){var e=l()(o.a.mark(function e(){var s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.selectAccounts.length){e.next=3;break}return this.$message({message:"请选择用户",type:"info"}),e.abrupt("return");case 3:return e.next=5,n.x({id:this.selectRole.id,accountIds:this.selectAccounts});case 5:(s=e.sent).code===a.b?this.$message({message:"用户绑定成功",type:"success"}):this.$message({message:s.message,type:"warning"});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleCurrentChange:function(){var e=l()(o.a.mark(function e(s){var t,i,r,l,m,c,d=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(this.selectRole=s,t=0;t<this.permissions.length;t++)(i=this.$refs.permissionTree.getNode({id:this.permissions[t].id}))&&(console.log(i),i.data.limitString="",i.data.limitDescription="");return e.next=4,n.p({id:s.id});case 4:if((r=e.sent).code===a.b){if(this.$refs.permissionTree){for(l=[],this.editRolePermissions=r.data.permissions,m=0;m<r.data.permissions.length;m++)l.push(r.data.permissions[m].permissionId),(c=this.$refs.permissionTree.getNode({id:r.data.permissions[m].permissionId}))&&(r.data.permissions[m].limitString&&(c.data.limitString=c.data.code+"?"+r.data.permissions[m].limitString),r.data.permissions[m].limitDescription&&(c.data.limitDescription=r.data.permissions[m].limitDescription));this.$refs.permissionTree.setCheckedKeys(l)}this.couldShowRolePermissionModal=!1,this.selectAccounts=r.data.accounts,setTimeout(function(){d.couldShowRolePermissionModal=!0},50)}else this.$message({message:r.message,type:"warning"});case 6:case"end":return e.stop()}},e,this)}));return function(s){return e.apply(this,arguments)}}(),deleteRole:function(e){var s=this;this.$confirm("删除 "+e.name+" ？","删除角色",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(l()(o.a.mark(function t(){var i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.g(e.id);case 2:if(t.sent.code!==a.b){t.next=14;break}i=0;case 5:if(!(i<s.roles.length)){t.next=12;break}if(s.roles[i].id!==e.id){t.next=9;break}return s.roles.splice(i,1),t.abrupt("break",12);case 9:i++,t.next=5;break;case 12:s.showRoleFormModal=!1,s.$message({type:"success",message:"已删除 "+e.name});case 14:case"end":return t.stop()}},t,s)})))},handleDragStart:function(e,s){console.log("drag start",e)},handleDragEnter:function(e,s,t){console.log("tree drag enter: ",s.label)},handleDragLeave:function(e,s,t){console.log("tree drag leave: ",s.label)},handleDragOver:function(e,s,t){console.log("tree drag over: ",s.label)},handleDragEnd:function(e,s,t,i){console.log("tree drag end: ",s&&s.label,t)},handleDrop:function(e,s,t,i){console.log("tree drop: ",s.label,t)},allowDrop:function(e,s,t){},allowDrag:function(e){}}},h=(t(380),t(0)),f=Object(h.a)(p,function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("c-main",{attrs:{id:"page-roles"}},[t("header",{staticClass:"toolbar"},[t("c-level",[t("template",{slot:"left"},[t("div",{staticClass:"cell"},[t("div",{staticClass:"cell__content"},[t("h1",{staticClass:"toolbar__title"},[e._v("\n              角色管理\n              "),t("span",[e._v("平台角色管理")])])])])]),e._v(" "),t("template",{slot:"right"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(s){e.openRoleFormModal()}}},[e._v("添加角色")])],1)],2)],1),e._v(" "),t("el-container",[t("el-aside",{},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("角色列表")])]),e._v(" "),t("el-table",{ref:"roleTable",staticStyle:{width:"100%"},attrs:{data:e.roles,"show-header":!1,"highlight-current-row":!0},on:{"current-change":e.handleCurrentChange}},[t("el-table-column",{attrs:{prop:"name",label:"角色名称"}}),e._v(" "),t("el-table-column",{attrs:{width:"60px",align:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return t("span",{staticStyle:{float:"right"}},[t("el-button",{staticClass:"icon-pen5",attrs:{type:"text",size:"mini"},on:{click:function(t){e.openEditRoleModal(s.row)}}})],1)}}])})],1)],1)],1),e._v(" "),t("el-main",[t("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],attrs:{type:"border-card"},model:{value:e.tabActiveName,callback:function(s){e.tabActiveName=s},expression:"tabActiveName"}},[t("el-tab-pane",{attrs:{label:"分配权限",name:"first"}},[t("el-tree",{ref:"permissionTree",attrs:{data:e.permissionTree,"show-checkbox":"","node-key":"id","default-expand-all":!0,"default-checked-keys":e.selectPermissions,props:e.defaultProps},on:{"check-change":e.openRolePermissionModal},scopedSlots:e._u([{key:"default",fn:function(s){s.node;var i=s.data;return t("span",{staticClass:"custom-tree-node"},[t("span",[e._v(e._s(i.label))]),e._v(" "),t("span",[t("el-button",{staticClass:"permission-code",attrs:{type:"text",title:i.limitString||i.code||"-",size:"mini"}},[e._v(e._s("module0"===i.id?"权限码":i.limitString||i.code||"-"))]),e._v(" "),t("el-button",{staticClass:"permission-description",attrs:{type:"text",title:i.limitDescription||"-",size:"mini"}},[e._v(e._s("module0"===i.id?"权限描述":i.limitDescription||"-"))]),e._v(" "),t("el-button",{staticClass:"option-type",attrs:{type:"text",size:"mini"}},["module0"===i.id?t("span",[e._v("权限类型")]):e._e(),e._v(" "),1===i.type?t("span",[e._v("接口")]):e._e(),e._v(" "),2===i.type?t("span",[e._v("页面")]):e._e(),e._v(" "),3===i.type?t("span",[e._v("组件")]):e._e(),e._v(" "),"module0"===i.id||i.code?e._e():t("span",[e._v("-")])])],1)])}}])}),e._v(" "),t("br"),e._v(" "),t("el-button",{directives:[{name:"show",rawName:"v-show",value:0!=e.permissionTree.length,expression:"permissionTree.length != 0"}],attrs:{size:"small",type:"primary"},on:{click:function(s){e.savePermissions()}}},[e._v("绑定权限")])],1),e._v(" "),t("el-tab-pane",{attrs:{label:"分配用户",name:"second"}},[t("el-transfer",{staticStyle:{width:"100%"},attrs:{filterable:"","filter-method":e.filterMethod,"filter-placeholder":"输入用户名",titles:["未分配用户","已分配用户"],"button-texts":["移除 >","< 分配"],data:e.accounts},model:{value:e.selectAccounts,callback:function(s){e.selectAccounts=s},expression:"selectAccounts"}}),e._v(" "),t("br"),e._v(" "),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(s){e.saveAccounts()}}},[e._v("绑定用户")])],1)],1)],1)],1),e._v(" "),t("el-dialog",{attrs:{title:e.roleForm.id?"编辑角色":"添加角色",visible:e.showRoleFormModal},on:{"update:visible":function(s){e.showRoleFormModal=s}}},[t("el-form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.roleFormRules,"validate-on-rule-change":!1}},[t("el-form-item",{attrs:{label:"角色名称","label-width":"80px",prop:"name"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.roleForm.name,callback:function(s){e.$set(e.roleForm,"name",s)},expression:"roleForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"角色状态","label-width":"80px"}},[t("el-radio-group",{model:{value:e.roleForm.status,callback:function(s){e.$set(e.roleForm,"status",s)},expression:"roleForm.status"}},[t("el-radio",{attrs:{label:"1"}},[e._v("有效")]),e._v(" "),t("el-radio",{attrs:{label:"0"}},[e._v("无效")])],1)],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.roleForm.id,expression:"roleForm.id"}],staticStyle:{float:"left"},on:{click:function(s){e.deleteRole(e.roleForm)}}},[e._v("删除角色")]),e._v(" "),t("el-button",{on:{click:function(s){e.showRoleFormModal=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(s){e.submitRoleForm()}}},[e._v(e._s(e.roleForm.id?"保存":"添加"))])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"配置角色权限",visible:e.showRolePermissionModal,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(s){e.showRolePermissionModal=s}}},[t("el-form",{ref:"rolePermissionForm",attrs:{model:e.rolePermissionForm,"validate-on-rule-change":!1}},[t("el-form-item",{attrs:{label:"权限名称","label-width":"120px",prop:"name"}},[t("el-input",{attrs:{disabled:!0,autocomplete:"off"},model:{value:e.rolePermissionForm.name,callback:function(s){e.$set(e.rolePermissionForm,"name",s)},expression:"rolePermissionForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"权限类型","label-width":"120px",prop:"type"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:"请选择权限类型"},model:{value:e.rolePermissionForm.type,callback:function(s){e.$set(e.rolePermissionForm,"type",s)},expression:"rolePermissionForm.type"}},[t("el-option",{attrs:{label:"接口",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"页面",value:"2"}}),e._v(" "),t("el-option",{attrs:{label:"组件",value:"3"}})],1)],1),e._v(" "),1==e.rolePermissionForm.type?t("el-form-item",{attrs:{label:"角色权限码","label-width":"120px"}},[t("el-input",{attrs:{placeholder:"输入数据限制参数"},model:{value:e.rolePermissionForm.limitString,callback:function(s){e.$set(e.rolePermissionForm,"limitString",s)},expression:"rolePermissionForm.limitString"}},[t("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v(e._s(e.rolePermissionForm.code)+"?")])]),e._v(" "),t("p",{staticClass:"limit-fields"},[e._v(e._s(e.rolePermissionForm.limitFields))])],1):e._e(),e._v(" "),1!=e.rolePermissionForm.type?t("el-form-item",{attrs:{label:"角色权限码","label-width":"120px"}},[t("el-input",{attrs:{disabled:""},model:{value:e.rolePermissionForm.limitString,callback:function(s){e.$set(e.rolePermissionForm,"limitString",s)},expression:"rolePermissionForm.limitString"}}),e._v(" "),t("p",{staticClass:"limit-fields"},[e._v(e._s(e.rolePermissionForm.limitFields))])],1):e._e(),e._v(" "),t("el-form-item",{attrs:{label:"角色权限描述","label-width":"120px"}},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"输入角色权限描述"},model:{value:e.rolePermissionForm.limitDescription,callback:function(s){e.$set(e.rolePermissionForm,"limitDescription",s)},expression:"rolePermissionForm.limitDescription"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(s){e.cancelRolePermission(e.rolePermissionForm)}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(s){e.addRolePermission(e.rolePermissionForm)}}},[e._v("绑定")])],1)],1)],1)},[],!1,null,null,null);f.options.__file="roles.vue";s.default=f.exports}}]);